<div class="admin-page-wrapper">

  <div class="card admin-table-card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2 class="mb-0">Users</h2>

      <div class="d-flex align-items-center gap-2">
        <span class="me-1">Per page:</span>
        <select [(ngModel)]="perPage"
                (change)="reload()"
                class="form-select form-select-sm w-auto">
          <option *ngFor="let p of pageOptions" [value]="p">{{ p }}</option>
        </select>
      </div>
    </div>

    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-dark table-striped align-middle mb-0 table-users">
          <thead>
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Active</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of rows">
              <td>{{ u.id }}</td>
              <td>{{ u.name }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.role }}</td>
              <td>
                <span class="badge"
                      [class.bg-success]="u.isActive"
                      [class.bg-secondary]="!u.isActive">
                  {{ u.isActive ? 'Yes' : 'No' }}
                </span>
              </td>

              <!-- ⬇️ ОВА Е НОВО -->
              <td class="text-end actions-cell">
                <div class="actions-buttons">
                  <button class="btn btn-sm btn-outline-info"
                          (click)="openDetails(u)">
                    View
                  </button>

                  <button class="btn btn-sm btn-outline-warning"
                          [disabled]="togglingId === u.id"
                          (click)="toggleStatus(u)">
                    {{ u.isActive ? 'Deactivate' : 'Activate' }}
                  </button>
                </div>
              </td>
            </tr>

            <tr *ngIf="!rows.length">
              <td colspan="6" class="text-center py-3">
                No users found.
              </td>
            </tr>
          </tbody>
        </table>

      </div>
    </div>

    <div class="card-footer d-flex justify-content-between align-items-center">
      <button class="btn btn-outline-light btn-sm"
              [disabled]="page <= 1"
              (click)="prevPage()">
        Prev
      </button>

      <div>Page {{ page }} / {{ totalPages }}</div>

      <button class="btn btn-outline-light btn-sm"
              [disabled]="page >= totalPages"
              (click)="nextPage()">
        Next
      </button>
    </div>
  </div>

  <!-- MODAL: User details -->
  <div class="modal-backdrop fade show" *ngIf="detailsVisible"></div>

  <div class="custom-modal" *ngIf="detailsVisible">
    <div class="custom-modal-dialog">
      <div class="custom-modal-content">
        <div class="custom-modal-header">
          <h5 class="modal-title">
            User details – {{ selectedUser?.name || selectedRow?.name }}
          </h5>
          <button type="button"
                  class="btn-close btn-close-white"
                  (click)="closeDetails()"></button>
        </div>

        <div class="custom-modal-body" *ngIf="selectedUser">
          <div class="row">
            <div class="col-4 fw-semibold">ID</div>
            <div class="col-8">{{ selectedUser.id }}</div>

            <div class="col-4 fw-semibold mt-2">Name</div>
            <div class="col-8 mt-2">{{ selectedUser.name }}</div>

            <div class="col-4 fw-semibold mt-2">Email</div>
            <div class="col-8 mt-2">{{ selectedUser.email }}</div>

            <div class="col-4 fw-semibold mt-2">Company</div>
            <div class="col-8 mt-2">{{ selectedUser.companyName || '-' }}</div>

            <div class="col-4 fw-semibold mt-2">Role</div>
            <div class="col-8 mt-2">{{ selectedUser.role }}</div>

            <div class="col-4 fw-semibold mt-2">Active</div>
            <div class="col-8 mt-2">
              <span class="badge"
                    [class.bg-success]="selectedUser.isActive"
                    [class.bg-secondary]="!selectedUser.isActive">
                {{ selectedUser.isActive ? 'Yes' : 'No' }}
              </span>
            </div>

            <div class="col-4 fw-semibold mt-2">Created</div>
            <div class="col-8 mt-2">{{ selectedUser.createdAt || '-' }}</div>

            <div class="col-4 fw-semibold mt-2">Updated</div>
            <div class="col-8 mt-2">{{ selectedUser.updatedAt || '-' }}</div>
          </div>
        </div>

        <div class="custom-modal-footer">
          <button class="btn btn-secondary" (click)="closeDetails()">Close</button>
        </div>
      </div>
    </div>
  </div>

</div>
