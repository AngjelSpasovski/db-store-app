<div class="login-component d-flex justify-content-center align-items-center">
  <div class="login-wrapper">

    <!-- Back -->
    <button class="back-btn" (click)="goBackToHomePage()">
      <fa-icon [icon]="faArrowLeft"></fa-icon>
      {{ 'BACK_HOME' | translate }}
    </button>

    <!-- Tabs -->
    <div class="slide-controls">
      <button class="slide login"
              (click)="switchToLogin()"
              [ngClass]="{'active-tab': activeForm==='login'}">
        {{ 'LOGIN' | translate }}
      </button>

      <button class="slide signup"
              (click)="switchToSignup()"
              [ngClass]="{'active-tab': activeForm==='signup'}">
        {{ 'SIGNUP' | translate }}
      </button>

      <div class="slider-tab" [ngStyle]="{'left': activeForm==='login'? '0%' : '50%'}"></div>
    </div>

    <div class="form-inner">

      <!-- ======================= LOGIN ======================= -->
      <form *ngIf="activeForm==='login'"
            [formGroup]="loginForm"
            (ngSubmit)="onSubmitLogin()">

        <!-- Email not verified -->
        <div *ngIf="needsEmailVerify"
             class="alert alert-warning d-flex justify-content-between align-items-center gap-2 mb-3">
          <div>
            {{ infoMessage || ('EMAIL_NOT_VERIFIED_INFO' | translate) }}
          </div>

          <button type="button"
                  class="btn btn-sm btn-outline-dark"
                  [disabled]="resendLoading"
                  (click)="resendVerifyEmail()">
            <span *ngIf="!resendLoading">{{ 'RESEND_VERIFICATION' | translate }}</span>
            <span *ngIf="resendLoading">{{ 'SENDING' | translate }}</span>
          </button>
        </div>

        <!-- Other server-side error -->
        <div *ngIf="!needsEmailVerify && serverErrorMsg"
             class="alert alert-danger mb-3"
             style="white-space: pre-line">
          {{ serverErrorMsg }}
        </div>

        <!-- Email -->
        <div class="form-floating mb-1">
          <input type="email"
                 id="loginEmail"
                 class="form-control"
                 formControlName="email"
                 placeholder=" "
                 autocomplete="username"
                 [attr.aria-invalid]="loginSubmitted && loginForm.get('email')?.invalid ? 'true' : null"
                 [attr.aria-describedby]="loginSubmitted && loginForm.get('email')?.invalid ? 'loginEmailErr' : null"
                 [ngClass]="{'is-invalid': loginSubmitted && loginForm.get('email')?.invalid}" />
          <label for="loginEmail">{{ 'EMAIL' | translate }}</label>
          <div id="loginEmailErr"
               class="invalid-feedback"
               *ngIf="loginSubmitted && loginForm.get('email')?.invalid">
            {{ getError(loginForm,'email') }}
          </div>
        </div>

        <!-- Password -->
        <div class="form-floating mb-1 position-relative">
          <input [type]="showPassword ? 'text' : 'password'"
                 id="loginPass"
                 class="form-control"
                 formControlName="password"
                 placeholder=" "
                 autocomplete="current-password"
                 [attr.aria-invalid]="loginSubmitted && loginForm.get('password')?.invalid ? 'true' : null"
                 [attr.aria-describedby]="loginSubmitted && loginForm.get('password')?.invalid ? 'loginPassErr' : null"
                 [ngClass]="{'is-invalid': loginSubmitted && loginForm.get('password')?.invalid}" />
          <label for="loginPass">{{ 'PASSWORD' | translate }}</label>

          <button *ngIf="!(loginSubmitted && loginForm.get('password')?.invalid)"
                  class="toggle-password"
                  type="button"
                  (click)="togglePasswordVisibility()">
            <fa-icon [icon]="showPassword ? faEyeSlash : faEye"></fa-icon>
          </button>

          <div id="loginPassErr"
               class="invalid-feedback"
               *ngIf="loginSubmitted && loginForm.get('password')?.invalid">
            {{ getError(loginForm,'password') }}
          </div>
        </div>

        <!-- Forgot + Remember -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <a [routerLink]="['/forgot-password']"
             (click)="resetAllForms()
"
             class="forgot-password-link text-decoration-none">
            {{ 'FORGOT_PASSWORD' | translate }}
          </a>

          <div class="form-check">
            <input id="rememberMe"
                   type="checkbox"
                   class="form-check-input"
                   formControlName="rememberMe" />
            <label for="rememberMe" class="form-check-label">{{ 'REMEMBER_ME' | translate }}</label>
          </div>
        </div>

        <!-- Submit -->
        <button type="submit"
                class="btn btn-primary w-100 mt-2"
                [disabled]="loginForm.invalid || isSubmittingLogin"
                [attr.aria-busy]="isSubmittingLogin ? 'true' : null">
          {{ 'LOGIN' | translate }}
          <span *ngIf="isSubmittingLogin"
                class="spinner-border spinner-border-sm ms-2"
                role="status"
                aria-hidden="true"></span>
        </button>
      </form>

      <!-- ======================= SIGNUP ======================= -->
      <form *ngIf="activeForm==='signup'"
            [formGroup]="signupForm"
            (ngSubmit)="onSubmitSignup($event)"
            novalidate>

        <div class="row signup-columns">
          <!-- COL 1 -->
          <div class="col-md-4">
            <!-- Email -->
            <div class="form-floating mb-1">
              <input type="email"
                     id="suEmail"
                     class="form-control"
                     formControlName="email"
                     name="from_email"
                     placeholder=" "
                     autocomplete="email"
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('email')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('email')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('email')?.invalid ? 'suEmailErr' : null" />
              <label for="suEmail">{{ 'EMAIL' | translate }}</label>
              <div id="suEmailErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('email')?.invalid">
                {{ getError(signupForm,'email') }}
              </div>
            </div>

            <!-- Name -->
            <div class="form-floating mb-1">
              <input type="text"
                     id="suName"
                     class="form-control"
                     formControlName="name"
                     name="from_name"
                     placeholder=" "
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('name')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('name')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('name')?.invalid ? 'suNameErr' : null" />
              <label for="suName">{{ 'NAME' | translate }}</label>
              <div id="suNameErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('name')?.invalid">
                {{ getError(signupForm,'name') }}
              </div>
            </div>

            <!-- Surname -->
            <div class="form-floating mb-1">
              <input type="text"
                     id="suSurname"
                     class="form-control"
                     formControlName="surname"
                     placeholder=" "
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('surname')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('surname')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('surname')?.invalid ? 'suSurnameErr' : null" />
              <label for="suSurname">{{ 'SURNAME' | translate }}</label>
              <div id="suSurnameErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('surname')?.invalid">
                {{ getError(signupForm,'surname') }}
              </div>
            </div>

            <!-- Password -->
            <div class="form-floating mb-1 position-relative">
              <input [type]="showPassword ? 'text' : 'password'"
                     id="suPass"
                     class="form-control"
                     formControlName="password"
                     placeholder=" "
                     autocomplete="new-password"
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('password')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('password')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('password')?.invalid ? 'suPassErr' : null" />
              <label for="suPass">{{ 'PASSWORD' | translate }}</label>
              <button *ngIf="!(signupSubmitted && signupForm.get('password')?.invalid)"
                      class="toggle-password"
                      type="button"
                      (click)="togglePasswordVisibility()">
                <fa-icon [icon]="showPassword ? faEyeSlash : faEye"></fa-icon>
              </button>
              <div id="suPassErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('password')?.invalid">
                {{ getError(signupForm, 'password') }}
              </div>
            </div>

            <!-- Confirm Password -->
            <div class="form-floating mb-1 position-relative">
              <input [type]="showConfirmPassword ? 'text' : 'password'"
                     id="suConfirm"
                     class="form-control"
                     formControlName="confirmPassword"
                     placeholder=" "
                     autocomplete="new-password"
                     [ngClass]="{'is-invalid': signupSubmitted && (signupForm.get('confirmPassword')?.invalid || signupForm.errors?.['mismatch'])}"
                     [attr.aria-invalid]="signupSubmitted && (signupForm.get('confirmPassword')?.invalid || signupForm.errors?.['mismatch']) ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && (signupForm.get('confirmPassword')?.invalid || signupForm.errors?.['mismatch']) ? 'suConfirmErr' : null" />
              <label for="suConfirm">{{ 'CONFIRM_PASSWORD' | translate }}</label>
              <button *ngIf="!(signupSubmitted && (signupForm.get('confirmPassword')?.invalid || signupForm.errors?.['mismatch']))"
                      class="toggle-password"
                      type="button"
                      (click)="toggleConfirmPasswordVisibility()">
                <fa-icon [icon]="showConfirmPassword ? faEyeSlash : faEye"></fa-icon>
              </button>
              <div id="suConfirmErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && (signupForm.get('confirmPassword')?.invalid || signupForm.errors?.['mismatch'])">
                {{ getError(signupForm, 'confirmPassword') }}
              </div>
            </div>
          </div>

          <!-- COL 2 -->
          <div class="col-md-4">
            <div class="form-floating mb-1">
              <input type="text" id="suCompany" class="form-control"
                     formControlName="companyName" placeholder=" "
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('companyName')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('companyName')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('companyName')?.invalid ? 'suCompanyErr' : null" />
              <label for="suCompany">{{ 'COMPANY_NAME' | translate }}</label>
              <div id="suCompanyErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('companyName')?.invalid">
                {{ getError(signupForm,'companyName') }}
              </div>
            </div>

            <div class="form-floating mb-1">
              <input type="text" id="suPhone" class="form-control"
                     formControlName="phoneNumber" placeholder=" "
                     inputmode="numeric"
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('phoneNumber')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('phoneNumber')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('phoneNumber')?.invalid ? 'suPhoneErr' : null" />
              <label for="suPhone">{{ 'PHONE_NUMBER' | translate }}</label>
              <div id="suPhoneErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('phoneNumber')?.invalid">
                {{ getError(signupForm,'phoneNumber') }}
              </div>
            </div>

            <div class="form-floating mb-1">
              <input type="text" id="suVat" class="form-control"
                     formControlName="vat" placeholder=" "
                     inputmode="numeric"
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('vat')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('vat')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('vat')?.invalid ? 'suVatErr' : null" />
              <label for="suVat">{{ 'VAT_NUMBER' | translate }}</label>
              <div id="suVatErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('vat')?.invalid">
                {{ getError(signupForm,'vat') }}
              </div>
            </div>

            <div class="form-floating mb-1">
              <input type="text" id="suAddress" class="form-control"
                     formControlName="companyAddress" placeholder=" "
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('companyAddress')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('companyAddress')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('companyAddress')?.invalid ? 'suAddressErr' : null" />
              <label for="suAddress">{{ 'COMPANY_ADDRESS' | translate }}</label>
              <div id="suAddressErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('companyAddress')?.invalid">
                {{ getError(signupForm,'companyAddress') }}
              </div>
            </div>

            <div class="form-floating mb-1">
              <input type="text" id="suAddressSecond" class="form-control"
                     formControlName="companyAddressSecond" placeholder=" "
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('companyAddressSecond')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('companyAddressSecond')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('companyAddressSecond')?.invalid ? 'suAddress2Err' : null" />
              <label for="suAddressSecond">{{ 'COMPANY_ADDRESS_SECOND' | translate }}</label>
              <div id="suAddress2Err" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('companyAddressSecond')?.invalid">
                {{ getError(signupForm,'companyAddressSecond') }}
              </div>
            </div>
          </div>

          <!-- COL 3 -->
          <div class="col-md-4">
            <div class="form-floating mb-1">
              <input type="text" id="suCity" class="form-control"
                     formControlName="city" placeholder=" "
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('city')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('city')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('city')?.invalid ? 'suCityErr' : null" />
              <label for="suCity">{{ 'CITY' | translate }}</label>
              <div id="suCityErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('city')?.invalid">
                {{ getError(signupForm,'city') }}
              </div>
            </div>

            <div class="form-floating mb-1">
              <input type="text" id="suState" class="form-control"
                     formControlName="state" placeholder=" "
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('state')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('state')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('state')?.invalid ? 'suStateErr' : null" />
              <label for="suState">{{ 'STATE' | translate}}</label>
              <div id="suStateErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('state')?.invalid">
                {{ getError(signupForm,'state') }}
              </div>
            </div>

            <div class="form-floating mb-1">
              <input type="text" id="suZip" class="form-control"
                     formControlName="zip" placeholder=" "
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('zip')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('zip')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('zip')?.invalid ? 'suZipErr' : null" />
              <label for="suZip">{{ 'ZIP_CODE' | translate }}</label>
              <div id="suZipErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('zip')?.invalid">
                {{ getError(signupForm,'zip') }}
              </div>
            </div>

            <!-- Role (floating select) -->
            <div class="form-floating mb-1">
              <select id="suRole"
                      class="form-select"
                      formControlName="role"
                      [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('role')?.invalid}"
                      [attr.aria-invalid]="signupSubmitted && signupForm.get('role')?.invalid ? 'true' : null"
                      [attr.aria-describedby]="signupSubmitted && signupForm.get('role')?.invalid ? 'suRoleErr' : null">
                <option value="" disabled>{{ 'ROLE_IN_COMPANY' | translate }}</option>
                <option value="Owner">{{ 'OWNER' | translate }}</option>
                <option value="Marketing Manager">{{ 'MARKETING_MANAGER' | translate }}</option>
                <option value="Manager">{{ 'MANAGER' | translate }}</option>
                <option value="Delivery">{{ 'DELIVERY' | translate }}</option>
                <option value="Sales">{{ 'SALES' | translate }}</option>
                <option value="Other">{{ 'OTHER' | translate }}</option>
              </select>
              <div id="suRoleErr" class="invalid-feedback"
                   *ngIf="signupSubmitted && signupForm.get('role')?.invalid">
                {{ getError(signupForm,'role') }}
              </div>
            </div>

            <!-- File upload -->
            <div class="mb-1">
              <div class="file-upload-wrapper">
                <!-- Browse button -->
                <label for="fileInput" class="file-upload-btn">
                  {{ 'CHOOSE_FILE' | translate }}
                </label>

                <!-- Readonly filename -->
                <input type="text"
                      class="file-upload-filename form-control"
                      [value]="selectedFileName || ('NO_FILE_CHOSEN' | translate)"
                      title="{{ selectedFileName }}"
                      readonly
                      [ngClass]="{ 'is-invalid': signupSubmitted && signupForm.get('file')?.invalid }" />

                <!-- Clear button (видливо само кога има фајл) -->
                <button type="button"
                        class="file-clear-btn"
                        *ngIf="selectedFileName"
                        (click)="clearSelectedFile(fileInput)"
                        [attr.aria-label]="'REMOVE_FILE' | translate">
                  &times;
                </button>

                <!-- Hidden file input -->
                <input type="file"
                      id="fileInput"
                      hidden
                      accept="application/pdf"
                      (change)="onFileSelected($event)"
                      #fileInput />
              </div>

              <!-- Validation messages -->
              <div *ngIf="signupSubmitted && signupForm.get('file')?.hasError('required')"
                  class="invalid-feedback d-block text-right">
                {{ getError(signupForm, 'file') }}
              </div>
              <div *ngIf="signupSubmitted && signupForm.get('file')?.hasError('invalidFileType')"
                  class="invalid-feedback d-block text-right">
                {{ 'ONLY_PDF' | translate }}
              </div>
            </div>

          </div>
        </div>

        <!-- Consents -->
        <div class="mb-3 consents-wrapper">
          <!-- Left (required) -->
          <div class="consents-column left-consents">
            <div class="form-check">
              <input type="checkbox" id="privacyPolicy" class="form-check-input"
                     formControlName="privacyPolicy"
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('privacyPolicy')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('privacyPolicy')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('privacyPolicy')?.invalid ? 'privacyPolicyErr' : null" />
              <label class="form-check-label" for="privacyPolicy">
                {{ 'ACCEPT_TERMS_1' | translate }}
                <a href="../../../assets/privacy/privacy-policy/privacy-policy-IT.pdf"
                   target="_blank"
                   rel="noopener noreferrer">
                  {{ 'PRIVACY_POLICY' | translate }}
                </a>
              </label>
            </div>
            <div id="privacyPolicyErr"
                 *ngIf="signupSubmitted && signupForm.get('privacyPolicy')?.invalid"
                 class="invalid-feedback d-block"
                 style="text-align: left;">
              {{ 'PRIVACY_POLICY_REQUIRED' | translate }}
            </div>

            <div class="form-check">
              <input type="checkbox" id="consent1" class="form-check-input"
                     formControlName="consent1"
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('consent1')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('consent1')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('consent1')?.invalid ? 'consent1Err' : null" />
              <label class="form-check-label" for="consent1">
                {{ 'ACCEPT_TERMS_2' | translate }}
              </label>
            </div>
            <div id="consent1Err"
                 *ngIf="signupSubmitted && signupForm.get('consent1')?.invalid"
                 class="invalid-feedback d-block"
                 style="text-align: left;">
              {{ getError(signupForm, 'consent1') }}
            </div>

            <div class="form-check mt-2">
              <input type="checkbox" id="consent2" class="form-check-input"
                     formControlName="consent2"
                     [ngClass]="{'is-invalid': signupSubmitted && signupForm.get('consent2')?.invalid}"
                     [attr.aria-invalid]="signupSubmitted && signupForm.get('consent2')?.invalid ? 'true' : null"
                     [attr.aria-describedby]="signupSubmitted && signupForm.get('consent2')?.invalid ? 'consent2Err' : null" />
              <label class="form-check-label" for="consent2">
                {{ 'ACCEPT_TERMS_3' | translate }}
              </label>
            </div>
            <div id="consent2Err"
                 *ngIf="signupSubmitted && signupForm.get('consent2')?.invalid"
                 class="invalid-feedback d-block"
                 style="text-align: left;">
              {{ getError(signupForm, 'consent2') }}
            </div>
          </div>

          <!-- Right (optional) -->
          <div class="consents-column right-consents">
            <div class="form-check">
              <input type="checkbox" id="consent3" class="form-check-input" formControlName="consent3" />
              <label class="form-check-label" for="consent3">
                {{ 'ACCEPT_TERMS_4' | translate }}
              </label>
            </div>

            <div class="form-check mt-2">
              <input type="checkbox" id="consent4" class="form-check-input" formControlName="consent4" />
              <label class="form-check-label" for="consent4">
                {{ 'ACCEPT_TERMS_5' | translate }}
              </label>
            </div>

            <div class="form-check mt-2">
              <input type="checkbox" id="consent5" class="form-check-input" formControlName="consent5" />
              <label class="form-check-label" for="consent5">
                {{ 'ACCEPT_TERMS_6' | translate }}
              </label>
            </div>
          </div>
        </div>

        <!-- Submit -->
        <button type="submit" class="btn btn-primary w-100 mt-2">
          {{ 'SIGNUP' | translate }}
        </button>
      </form>

    </div>
  </div>
</div>
