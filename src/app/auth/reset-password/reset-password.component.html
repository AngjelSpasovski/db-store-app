<div class="reset-password-component">
  <div class="wrapper">

    <button class="back-btn" (click)="goBackToLogin()">
      <fa-icon [icon]="faArrowLeft"></fa-icon>
      {{ 'BACK_LOGIN' | translate }}
    </button>

    <h2 class="mb-2">{{ 'RESET_PASSWORD' | translate }}</h2>

    <ng-container [ngSwitch]="state">
      <!-- verifying -->
      <div *ngSwitchCase="'verifying'">{{ 'VERIFY_LINK' | translate }}</div>

      <!-- form -->
      <form *ngSwitchCase="'ok'" [formGroup]="form" (ngSubmit)="submit()" novalidate>
        <div class="field mb-3">
          <input
            id="rpNew"
            class="form-control"
            type="password"
            formControlName="password"
            [attr.aria-invalid]="(f['password'].touched || f['password'].dirty) && f['password'].invalid ? 'true' : null"
            [class.is-invalid]="(f['password'].touched || f['password'].dirty) && f['password'].invalid"
            placeholder="{{ 'NEW_PASSWORD' | translate }}"
            autocomplete="new-password"
          />
          <div class="invalid-feedback d-block" *ngIf="(f['password'].touched || f['password'].dirty) && f['password'].invalid">
            {{ 'RESET_MIN_LENGTH' | translate }}
          </div>
        </div>

        <div class="field mb-3">
          <input
            id="rpConfirm"
            class="form-control"
            type="password"
            formControlName="confirm"
            [attr.aria-invalid]="(f['confirm'].touched || f['confirm'].dirty || form.errors?.['mismatch']) ? 'true' : null"
            [class.is-invalid]="(f['confirm'].touched || f['confirm'].dirty) && (f['confirm'].invalid || form.errors?.['mismatch'])"
            placeholder="{{ 'CONFIRM_PASSWORD' | translate }}"
            autocomplete="new-password"
          />
          <div class="invalid-feedback d-block" *ngIf="(f['confirm'].touched || f['confirm'].dirty) && (f['confirm'].invalid || form.errors?.['mismatch'])">
            {{ 'PASSWORD_MISMATCH' | translate }}
          </div>
        </div>

        <button
          class="btn btn-primary w-100"
          type="submit"
          [disabled]="form.invalid || state==='saving'"
          [attr.aria-busy]="state==='saving'">
          {{ 'SET_PASSWORD' | translate }}
          <span *ngIf="state==='saving'" class="spinner-border spinner-border-sm ms-2" role="status" aria-hidden="true"></span>
        </button>

        <div class="form-text mt-2 text-danger" *ngIf="message">{{ message }}</div>
      </form>

      <!-- saving -->
      <div *ngSwitchCase="'saving'">{{ 'SAVING' | translate }}</div>

      <!-- done -->
      <div *ngSwitchCase="'done'" class="alert alert-success">
        {{ 'PASSWORD_CHANGED' | translate }}
        <a routerLink="/login" [queryParams]="{ tab: 'login' }">{{ 'BACK_LOGIN' | translate }}</a>
      </div>

      <!-- fail -->
      <div *ngSwitchCase="'fail'" class="alert alert-danger">
        {{ message }}
        <a routerLink="/forgot-password">{{ 'REQUEST_NEW_LINK' | translate }}</a>
      </div>
    </ng-container>

  </div>
</div>
