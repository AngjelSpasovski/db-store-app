<div class="page">
  <div class="panel">
    <div class="panel-head">
      <div class="title">ADMINS</div>

      <div class="right">
        <span class="pill">TOTAL: {{ total }}</span>

        <button class="btn btn-primary" type="button" (click)="openCreate()" [disabled]="loading">
          + New admin
        </button>
      </div>
    </div>

    <div class="panel-body">
      <div class="loading" *ngIf="loading">Loading...</div>

      <table class="tbl" *ngIf="!loading">
        <thead>
          <tr>
            <th class="col-id">#</th>
            <th>Name</th>
            <th>Email</th>
            <th>Company</th>
            <th class="col-active">Active</th>
            <th class="col-actions">Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngIf="admins.length === 0">
            <td colspan="6" class="empty">No admins found.</td>
          </tr>

          <tr *ngFor="let a of admins">
            <td class="muted">{{ a.id }}</td>
            <td>{{ a.firstName }} {{ a.lastName }}</td>
            <td>{{ a.email }}</td>
            <td>{{ a.companyName || '-' }}</td>
            <td>
              <span class="badge" [class.ok]="a.isActive" [class.no]="!a.isActive">
                {{ a.isActive ? 'Yes' : 'No' }}
              </span>
            </td>
            <td class="actions">
              <button class="btn btn-dark-outline" type="button" (click)="openEdit(a)" [disabled]="loading">
                Edit
              </button>

              <button class="btn btn-danger-outline" type="button" (click)="deleteAdmin(a)" [disabled]="loading">
                Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="pager" *ngIf="!loading && total > perPage">
        <button class="btn btn-dark-outline" type="button" (click)="page = page - 1; load()" [disabled]="page <= 1">
          Prev
        </button>

        <div class="muted">Page {{ page }}</div>

        <button
          class="btn btn-dark-outline"
          type="button"
          (click)="page = page + 1; load()"
          [disabled]="page * perPage >= total"
        >
          Next
        </button>
      </div>
    </div>
  </div>

  <!-- CREATE MODAL -->
  <div class="sa-backdrop" *ngIf="showCreateModal" (click)="closeCreate()">
    <div class="sa-modal" (click)="$event.stopPropagation()">
      <div class="sa-head">
        <div class="sa-title">CREATE ADMIN</div>
        <button class="icon-btn" type="button" (click)="closeCreate()">✕</button>
      </div>

      <form class="sa-body" [formGroup]="createForm" (ngSubmit)="submitCreate()">
        <div class="grid-2">
          <div class="field">
            <label>First name</label>
            <input type="text" formControlName="firstName" />
            <div class="err" *ngIf="isTouchedInvalid('firstName')">Required</div>
          </div>

          <div class="field">
            <label>Last name</label>
            <input type="text" formControlName="lastName" />
            <div class="err" *ngIf="isTouchedInvalid('lastName')">Required</div>
          </div>
        </div>

        <div class="field">
          <label>Email</label>
          <input type="email" formControlName="email" />

          <div class="err" *ngIf="isTouchedInvalid('email') && !createForm.controls.email.hasError('emailExists')">
            Valid email required
          </div>

          <div class="err" *ngIf="createForm.controls.email.touched && createForm.controls.email.hasError('emailExists')">
            Email already exists. This account is already registered as a user.
          </div>
        </div>

        <div class="field">
          <label>Company</label>
          <input type="text" formControlName="companyName" />
        </div>

        <div class="field">
          <label>Password</label>
          <input type="password" formControlName="password" autocomplete="new-password" />
          <div class="hint">Min 8 characters.</div>
          <div class="err" *ngIf="isTouchedInvalid('password')">Password required (min 8)</div>
        </div>

        <!-- ✅ ТРГНАТО isActive, затоа што backend POST schema нема isActive -->

        <div class="sa-actions">
          <button class="btn btn-dark-outline" type="button" (click)="closeCreate()">Cancel</button>
          <button class="btn btn-primary" type="submit" [disabled]="loading">Create admin</button>
        </div>
      </form>
    </div>
  </div>

  <!-- EDIT MODAL -->
  <div class="sa-backdrop" *ngIf="showEditModal" (click)="closeEdit()">
    <div class="sa-modal" (click)="$event.stopPropagation()">
      <div class="sa-head">
        <div class="sa-title">EDIT ADMIN</div>
        <button class="icon-btn" type="button" (click)="closeEdit()">✕</button>
      </div>

      <form class="sa-body" [formGroup]="editForm" (ngSubmit)="submitEdit()">
        <div class="grid-2">
          <div class="field">
            <label>First name</label>
            <input type="text" formControlName="firstName" />
            <div class="err" *ngIf="isTouchedInvalidEdit('firstName')">Required</div>
          </div>

          <div class="field">
            <label>Last name</label>
            <input type="text" formControlName="lastName" />
            <div class="err" *ngIf="isTouchedInvalidEdit('lastName')">Required</div>
          </div>
        </div>

        <div class="field">
          <label>Company</label>
          <input type="text" formControlName="companyName" />
        </div>

        <div class="field">
          <label>New password (optional)</label>
          <input type="password" formControlName="password" autocomplete="new-password" />
          <div class="hint">Leave empty to keep current password.</div>
          <div class="err" *ngIf="editForm.controls.password.touched && editForm.controls.password.hasError('minlength')">
            Min 8 characters
          </div>
        </div>

        <div class="sa-actions">
          <button class="btn btn-dark-outline" type="button" (click)="closeEdit()">Cancel</button>
          <button class="btn btn-primary" type="submit" [disabled]="loading">Save changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
