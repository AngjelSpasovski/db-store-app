<!-- src/app/superadmin/packages/packages.component.html -->
<section class="superadmin-packages container py-3">

  <div class="card list-card mb-3">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center gap-3">
        <span class="card-title">Packages</span>
        <span class="badge bg-secondary small">Total: {{ total }}</span>
      </div>

      <button class="btn btn-sm btn-primary" (click)="openCreateModal()">
        + New package
      </button>
    </div>

    <div class="card-body p-0">
      <div *ngIf="loading" class="p-3 small text-muted">
        Loading packages...
      </div>

      <div *ngIf="!loading && error" class="p-3 text-danger small">
        {{ error }}
      </div>

      <table *ngIf="!loading && !error"
             class="table table-dark table-sm mb-0 align-middle">
        <thead>
          <tr>
            <th>Name</th>
            <th class="text-end">Credits</th>
            <th class="text-end">Price</th>
            <th class="text-end">Discount %</th>
            <th class="text-center">Status</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let pkg of packages">
            <td>{{ pkg.name }}</td>
            <td class="text-end">{{ pkg.credits }}</td>
            <td class="text-end">{{ pkg.price | number:'1.2-2' }}</td>
            <td class="text-end">{{ pkg.discountPercentage }}</td>

            <!-- display-only -->
            <td class="text-center">
              <span class="badge" [ngClass]="pkg.isActive ? 'bg-success' : 'bg-secondary'">
                {{ pkg.isActive ? 'Active' : 'Inactive' }}
              </span>
            </td>

            <td class="text-end">
              <!-- MUST be enabled even for inactive packages (to re-activate via modal) -->
              <button class="btn btn-sm btn-outline-light"
                      (click)="openEditModal(pkg)"
                      [disabled]="saving">
                Edit
              </button>
            </td>
          </tr>

          <tr *ngIf="packages.length === 0 && !loading">
            <td colspan="6" class="text-center small text-muted py-3">
              No packages yet.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card-footer small text-muted d-flex justify-content-between">
      <span>Per page: {{ perPage }}</span>
    </div>
  </div>

  <!-- MODAL BACKDROP -->
  <div *ngIf="showFormModal"
       class="modal-backdrop-custom"
       (click)="closeModal()"></div>

  <!-- MODAL -->
  <div *ngIf="showFormModal"
       class="modal-custom"
       (click)="$event.stopPropagation()">

    <div class="card form-card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>{{ editingPackage ? 'Edit package' : 'Create package' }}</span>

        <button type="button"
                class="btn-close btn-close-white"
                aria-label="Close"
                (click)="closeModal()"></button>
      </div>

      <div class="card-body">
        <form [formGroup]="form" (ngSubmit)="submit()">

          <div class="mb-2">
            <label class="form-label">Name</label>
            <input type="text"
                   class="form-control form-control-sm"
                   formControlName="name">
          </div>

          <div class="mb-2">
            <label class="form-label">Description</label>
            <textarea rows="2"
                      class="form-control form-control-sm"
                      formControlName="description"></textarea>
          </div>

          <div class="row g-2 mb-2">
            <div class="col-4">
              <label class="form-label">Credits</label>
              <input type="number"
                     class="form-control form-control-sm"
                     formControlName="credits">
            </div>

            <div class="col-4">
              <label class="form-label">Price</label>
              <input type="number"
                     step="0.01"
                     class="form-control form-control-sm"
                     formControlName="price">
            </div>

            <div class="col-4">
              <label class="form-label">Discount %</label>
              <input type="number"
                     class="form-control form-control-sm"
                     formControlName="discountPercentage">
            </div>
          </div>

          <!-- ONLY place to change isActive -->
          <div class="form-check form-switch mb-2">
            <input class="form-check-input"
                   type="checkbox"
                   formControlName="isActive"
                   id="isActiveSwitch">
            <label class="form-check-label" for="isActiveSwitch">Active</label>
          </div>

          <div *ngIf="form.value?.isActive === false"
               class="small text-warning mb-3">
            Inactive packages wonâ€™t be available to users.
          </div>

          <div class="d-flex justify-content-between">
            <button type="button"
                    class="btn btn-outline-secondary btn-sm"
                    (click)="onReset()"
                    [disabled]="saving">
              Reset
            </button>

            <button type="submit"
                    [disabled]="saving || form.invalid"
                    class="btn btn-primary btn-sm">
              <span *ngIf="!saving">
                {{ editingPackage ? 'Save changes' : 'Create package' }}
              </span>
              <span *ngIf="saving">
                <span class="spinner-border spinner-border-sm me-1"></span>
                Saving...
              </span>
            </button>
          </div>

        </form>
      </div>
    </div>

  </div>
</section>
